cluster_name            = "{{ global_vault_raft_cluster_name }}"
api_addr                = "https://{{ ansible_default_ipv4.address }}:{{ global_vault_host_listening_port }}"
cluster_addr            = "https://{{ ansible_default_ipv4.address }}:{{ global_vault_raft_cluster_port }}"
max_lease_ttl           = "768h"
default_lease_ttl       = "24h"
ui                      = true
disable_mlock           = true
raw_storage_endpoint    = true
disable_sealwrap        = true
disable_printable_check = true

listener "tcp" {
  address               = "{{ global_vault_host_listening_address }}:{{ global_vault_host_listening_port }}"
  tls_client_ca_file    = "{{ global_vault_system_internal_dir_node_certificates }}/{{ global_vault_system_internal_file_ca_certificate }}"
  tls_cert_file         = "{{ global_vault_system_internal_dir_node_certificates }}/{{ inventory_hostname }}.crt.pem"
  tls_key_file          = "{{ global_vault_system_internal_dir_node_certificates }}/{{ inventory_hostname }}.key.pem"
  tls_disable           = "false"
}

storage "raft" {
  path                = "{{ local_vault_manual_raft_cluster_dir_raft }}"
  node_id             = "vault-{{ inventory_hostname }}-node"

{% for host in groups[vault_raft_cluster_inventory_group | default("vault")] %}
{% if host != inventory_hostname %}
  retry_join {
    leader_api_addr         = "https://{{ hostvars[host]['ansible_default_ipv4']['address'] }}:{{ global_vault_host_listening_port }}"
    leader_ca_cert_file     = "{{ global_vault_system_internal_dir_node_certificates }}/{{ global_vault_system_internal_file_ca_certificate }}"
    leader_client_cert_file = "{{ global_vault_system_internal_dir_node_certificates }}/{{ inventory_hostname }}.crt.pem"
    leader_client_key_file  = "{{ global_vault_system_internal_dir_node_certificates }}/{{ inventory_hostname }}.key.pem"
  }
{% endif %}
{% endfor %}
}
